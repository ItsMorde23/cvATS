<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATS Resume Builder 2.0</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50; /* Azul oscuro corporativo */
            --accent: #3498db;  /* Azul más claro para detalles */
            --bg-editor: #f3f4f6;
            --bg-preview: #52525b;
            --border: #d1d5db;
        }

        body { font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* --- EDITOR (IZQUIERDA) --- */
        .editor-pane { width: 35%; background: var(--bg-editor); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .editor-header { padding: 15px 20px; background: white; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .editor-header h1 { margin: 0; font-size: 1.1rem; color: var(--primary); }
        
        .editor-content { flex: 1; overflow-y: auto; padding: 20px; }

        .btn { padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.85rem; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #1a252f; }
        .btn-outline { background: white; border: 1px solid #ccc; color: #333; }
        .btn-danger { background: #fee2e2; color: #b91c1c; }

        /* Inputs y Grupos */
        .section-card { background: white; border: 1px solid var(--border); border-radius: 8px; padding: 15px; margin-bottom: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .section-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 15px; color: var(--primary); border-bottom: 2px solid #e5e7eb; padding-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; margin-bottom: 4px; font-size: 0.8rem; font-weight: 600; color: #4b5563; }
        .form-control { width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 0.9rem; box-sizing: border-box; }
        textarea.form-control { resize: vertical; min-height: 60px; font-family: inherit; }

        /* Items Dinámicos */
        .item-card { background: #f9fafb; padding: 12px; border: 1px solid #e5e7eb; border-radius: 6px; margin-bottom: 8px; position: relative; }
        .delete-btn { position: absolute; top: 8px; right: 8px; color: #ef4444; cursor: pointer; font-size: 0.9rem; }

        /* Toggle Switch para Foto */
        .toggle-container { display: flex; align-items: center; gap: 10px; font-size: 0.85rem; margin-bottom: 10px; }
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* --- PREVIEW (DERECHA) --- */
        .preview-pane { width: 65%; background: var(--bg-preview); padding: 30px; overflow-y: auto; display: flex; justify-content: center; }
        
        /* HOJA A4 */
        #resume-preview {
            background: white;
            width: 210mm;
            min-height: 297mm;
            padding: 20mm 20mm; /* Márgenes seguros ATS */
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            box-sizing: border-box;
            color: #000;
        }

        /* --- ESTILOS DEL CV (ATS OPTIMIZED) --- */
        /* Header Flex para soportar foto sin tablas */
        .cv-header-container { display: flex; gap: 25px; align-items: flex-start; margin-bottom: 25px; border-bottom: 2px solid #000; padding-bottom: 20px; }
        .cv-photo-box { width: 100px; height: 100px; border-radius: 50%; overflow: hidden; flex-shrink: 0; display: none; /* Oculto por defecto */ border: 1px solid #ccc; }
        .cv-photo-box img { width: 100%; height: 100%; object-fit: cover; }
        .cv-photo-box.visible { display: block; }
        
        .cv-header-text { flex: 1; }
        .cv-name { font-family: 'Arial', sans-serif; font-size: 26pt; font-weight: 800; text-transform: uppercase; color: #222; line-height: 1.1; margin-bottom: 8px; }
        .cv-contact { font-family: 'Arial', sans-serif; font-size: 10pt; color: #444; line-height: 1.4; }
        
        /* Secciones */
        .cv-section-title {
            font-family: 'Arial', sans-serif;
            font-size: 13pt;
            font-weight: 700;
            text-transform: uppercase;
            border-bottom: 1px solid #ccc;
            margin-top: 20px;
            margin-bottom: 12px;
            padding-bottom: 2px;
            color: #000;
            letter-spacing: 0.5px;
        }

        .cv-item { margin-bottom: 14px; }
        .cv-item-header { display: flex; justify-content: space-between; font-family: 'Arial', sans-serif; margin-bottom: 3px; align-items: baseline; }
        .cv-role { font-weight: 700; font-size: 11.5pt; color: #000; }
        .cv-company { font-weight: 600; font-size: 11pt; color: #444; font-style: normal; }
        .cv-dates { font-size: 10pt; font-style: italic; text-align: right; min-width: 120px; }
        
        .cv-list { margin: 4px 0 0 0; padding-left: 18px; font-family: 'Arial', sans-serif; font-size: 10.5pt; line-height: 1.45; color: #333; }
        .cv-list li { margin-bottom: 3px; }
        .cv-summary { font-family: 'Arial', sans-serif; font-size: 10.5pt; line-height: 1.5; text-align: left; color: #333; }

        @media print {
            .editor-pane { display: none; }
            .preview-pane { width: 100%; padding: 0; display: block; height: auto; overflow: visible; }
            #resume-preview { width: 100%; box-shadow: none; margin: 0; padding: 0; }
            @page { margin: 15mm 20mm; size: A4; }
        }
    </style>
</head>
<body>

    <div class="editor-pane">
        <div class="editor-header">
            <h1>ATS Builder v2.0</h1>
            <div style="display:flex; gap:5px">
                <button class="btn btn-outline" onclick="app.loadExample()">Ejemplo</button>
                <button class="btn btn-danger" onclick="app.clearData()"><i class="fas fa-trash"></i></button>
                <button class="btn btn-primary" onclick="window.print()"><i class="fas fa-download"></i> PDF</button>
            </div>
        </div>

        <div class="editor-content" id="form-container">
            </div>
    </div>

    <div class="preview-pane">
        <div id="resume-preview">
            </div>
    </div>

    <script>
        const app = {
            data: {
                settings: { showPhoto: true },
                photo: null, // Base64 string
                personal: { name: '', email: '', phone: '', linkedin: '', location: '', summary: '' },
                experience: [],
                education: [],
                skills: ''
            },

            init() {
                this.loadFromStorage();
                this.renderForm();
                this.renderPreview();
            },

            save() {
                localStorage.setItem('atsResumeDataV2', JSON.stringify(this.data));
                this.renderPreview();
            },

            loadFromStorage() {
                const stored = localStorage.getItem('atsResumeDataV2');
                if (stored) this.data = JSON.parse(stored);
            },

            clearData() {
                if(confirm("¿Borrar todo?")) {
                    localStorage.removeItem('atsResumeDataV2');
                    this.data.personal = { name: '', email: '', phone: '', linkedin: '', location: '', summary: '' };
                    this.data.experience = [];
                    this.data.education = [];
                    this.data.skills = '';
                    this.data.photo = null;
                    this.renderForm();
                    this.renderPreview();
                }
            },

            // --- MANEJO DE IMÁGENES ---
            handleImageUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.data.photo = e.target.result;
                        this.save();
                    };
                    reader.readAsDataURL(file);
                }
            },

            togglePhoto() {
                this.data.settings.showPhoto = !this.data.settings.showPhoto;
                this.save();
            },

            loadExample() {
                this.data = {
                    settings: { showPhoto: true },
                    photo: null, // Dejamos foto vacía en ejemplo para no pesar
                    personal: {
                        name: "Sofía Martínez",
                        email: "sofia.dev@email.com",
                        phone: "+54 9 11 9876-5432",
                        linkedin: "linkedin.com/in/sofiamartinez",
                        location: "Buenos Aires, Argentina",
                        summary: "Ingeniera de Software apasionada por el desarrollo backend y la arquitectura de microservicios. Experiencia comprobable liderando equipos técnicos y optimizando bases de datos de alto rendimiento."
                    },
                    experience: [
                        {
                            role: "Senior Backend Engineer",
                            company: "MercadoTech",
                            dates: "06/2022 - Presente",
                            description: "• Lideré la migración de un monolito a microservicios en Go y Node.js.\n• Reduje la latencia de la API principal en un 30% mediante optimización de queries SQL.\n• Mentoring de 3 desarrolladores junior."
                        },
                        {
                            role: "Full Stack Developer",
                            company: "Startup Innovadora",
                            dates: "01/2020 - 05/2022",
                            description: "• Desarrollo de features completas usando React y Python (Django).\n• Implementación de tests automatizados aumentando la cobertura al 85%."
                        }
                    ],
                    education: [
                        { degree: "Ingeniería en Informática", school: "UBA - Universidad de Buenos Aires", year: "2023" }
                    ],
                    skills: "Golang, Node.js, PostgreSQL, Docker, Kubernetes, AWS, React, English (C1)"
                };
                this.save();
                this.renderForm();
            },

            // --- UPDATE HELPER ---
            updateField(section, field, value, index = null) {
                if (index !== null) this.data[section][index][field] = value;
                else if (typeof this.data[section] === 'object' && !Array.isArray(this.data[section])) this.data[section][field] = value;
                else this.data[section] = value;
                this.save();
            },
            
            addItem(section) {
                const item = section === 'experience' 
                    ? { role: '', company: '', dates: '', description: '' }
                    : { degree: '', school: '', year: '' };
                this.data[section].push(item);
                this.save();
                this.renderForm();
            },

            removeItem(section, index) {
                this.data[section].splice(index, 1);
                this.save();
                this.renderForm();
            },

            // --- RENDERS ---
            renderForm() {
                const container = document.getElementById('form-container');
                container.innerHTML = `
                    <div class="section-card">
                        <div class="section-title">Foto de Perfil</div>
                        <div class="toggle-container">
                            <label class="switch">
                                <input type="checkbox" ${this.data.settings.showPhoto ? 'checked' : ''} onchange="app.togglePhoto()">
                                <span class="slider"></span>
                            </label>
                            <span>Mostrar foto en CV</span>
                        </div>
                        <input type="file" accept="image/*" onchange="app.handleImageUpload(event)" class="form-control">
                    </div>

                    <div class="section-card">
                        <div class="section-title">Datos Personales</div>
                        <div class="form-group"><input class="form-control" placeholder="Nombre" value="${this.data.personal.name}" oninput="app.updateField('personal', 'name', this.value)"></div>
                        <div class="form-group"><input class="form-control" placeholder="Título Profesional (opcional)" value="${this.data.personal.location}" oninput="app.updateField('personal', 'location', this.value)"></div>
                        <div class="form-group"><input class="form-control" placeholder="Email" value="${this.data.personal.email}" oninput="app.updateField('personal', 'email', this.value)"></div>
                        <div class="form-group"><input class="form-control" placeholder="Teléfono" value="${this.data.personal.phone}" oninput="app.updateField('personal', 'phone', this.value)"></div>
                        <div class="form-group"><input class="form-control" placeholder="LinkedIn" value="${this.data.personal.linkedin}" oninput="app.updateField('personal', 'linkedin', this.value)"></div>
                        <div class="form-group"><textarea class="form-control" placeholder="Perfil Profesional" oninput="app.updateField('personal', 'summary', this.value)">${this.data.personal.summary}</textarea></div>
                    </div>
                `;

                // Experiencia
                let expHTML = `<div class="section-card"><div class="section-title">Experiencia <button class="btn btn-primary" onclick="app.addItem('experience')">+</button></div>`;
                this.data.experience.forEach((item, index) => {
                    expHTML += `
                        <div class="item-card">
                            <i class="fas fa-times delete-btn" onclick="app.removeItem('experience', ${index})"></i>
                            <div class="form-group"><input class="form-control" placeholder="Puesto" value="${item.role}" oninput="app.updateField('experience', 'role', this.value, ${index})"></div>
                            <div class="form-group"><input class="form-control" placeholder="Empresa" value="${item.company}" oninput="app.updateField('experience', 'company', this.value, ${index})"></div>
                            <div class="form-group"><input class="form-control" placeholder="Fechas" value="${item.dates}" oninput="app.updateField('experience', 'dates', this.value, ${index})"></div>
                            <div class="form-group"><textarea class="form-control" placeholder="Logros..." oninput="app.updateField('experience', 'description', this.value, ${index})">${item.description}</textarea></div>
                        </div>`;
                });
                container.insertAdjacentHTML('beforeend', expHTML + '</div>');

                // Educación
                let eduHTML = `<div class="section-card"><div class="section-title">Educación <button class="btn btn-primary" onclick="app.addItem('education')">+</button></div>`;
                this.data.education.forEach((item, index) => {
                    eduHTML += `
                        <div class="item-card">
                            <i class="fas fa-times delete-btn" onclick="app.removeItem('education', ${index})"></i>
                            <div class="form-group"><input class="form-control" placeholder="Título" value="${item.degree}" oninput="app.updateField('education', 'degree', this.value, ${index})"></div>
                            <div class="form-group"><input class="form-control" placeholder="Institución" value="${item.school}" oninput="app.updateField('education', 'school', this.value, ${index})"></div>
                            <div class="form-group"><input class="form-control" placeholder="Año" value="${item.year}" oninput="app.updateField('education', 'year', this.value, ${index})"></div>
                        </div>`;
                });
                container.insertAdjacentHTML('beforeend', eduHTML + '</div>');

                // Skills
                container.insertAdjacentHTML('beforeend', `<div class="section-card"><div class="section-title">Skills</div><textarea class="form-control" oninput="app.updateField('skills', null, this.value)">${this.data.skills}</textarea></div>`);
            },

            renderPreview() {
                const p = this.data.personal;
                const formatList = (txt) => {
                    if(!txt) return '';
                    const lines = txt.split('\n').filter(l => l.trim());
                    if(!lines.length) return '';
                    return `<ul class="cv-list">${lines.map(l => `<li>${l.replace(/^[•-]\s*/, '')}</li>`).join('')}</ul>`;
                };

                let html = `
                    <div class="cv-header-container">
                        <div class="cv-photo-box ${this.data.settings.showPhoto && this.data.photo ? 'visible' : ''}">
                            <img src="${this.data.photo || ''}" alt="Foto CV">
                        </div>
                        <div class="cv-header-text">
                            <div class="cv-name">${p.name || 'NOMBRE'}</div>
                            <div class="cv-contact">
                                ${p.location ? `${p.location}<br>` : ''}
                                ${p.email ? `${p.email} | ` : ''} 
                                ${p.phone ? `${p.phone}` : ''} <br>
                                ${p.linkedin ? `${p.linkedin}` : ''}
                            </div>
                        </div>
                    </div>
                `;

                if(p.summary) html += `<div class="cv-section-title">Perfil Profesional</div><div class="cv-summary">${p.summary}</div>`;
                
                if(this.data.experience.length) {
                    html += `<div class="cv-section-title">Experiencia Profesional</div>`;
                    this.data.experience.forEach(e => {
                        html += `
                        <div class="cv-item">
                            <div class="cv-item-header">
                                <div><span class="cv-role">${e.role}</span>${e.company ? ` en <span class="cv-company">${e.company}</span>` : ''}</div>
                                <div class="cv-dates">${e.dates}</div>
                            </div>
                            ${formatList(e.description)}
                        </div>`;
                    });
                }

                if(this.data.education.length) {
                    html += `<div class="cv-section-title">Educación</div>`;
                    this.data.education.forEach(e => {
                        html += `
                        <div class="cv-item">
                            <div class="cv-item-header">
                                <div class="cv-role">${e.degree}</div>
                                <div class="cv-dates">${e.year}</div>
                            </div>
                            <div>${e.school}</div>
                        </div>`;
                    });
                }

                if(this.data.skills) html += `<div class="cv-section-title">Habilidades</div><div class="cv-summary">${this.data.skills}</div>`;

                document.getElementById('resume-preview').innerHTML = html;
            }
        };

        app.init();
    </script>
</body>
</html>
